plugins {
    id 'com.github.spotbugs'
}

tasks.withType(com.github.spotbugs.snom.SpotBugsTask).forEach { spotbugsTask ->
    spotbugsTask.configure {
        reports.configure {
            xml.enabled = false
            html.enabled = true
        }
    }
}

spotbugs {
    excludeFilter = file("${rootDir}/config/spotbugs-exclude.xml")
    toolVersion = '4.6.0'
}

tasks.withType(Test).forEach { testTask ->
    tasks.withType(com.github.spotbugs.snom.SpotBugsTask).forEach { spotbugsTask ->
        String expected = ("spotbugs" + testTask.getName()).toLowerCase()
        if (expected == spotbugsTask.getName().toLowerCase()) {
            testTask.shouldRunAfter(spotbugsTask)
        }
        if (spotbugsTask.getName() == "spotbugsMain") {
            testTask.shouldRunAfter(spotbugsTask)
        }
    }
}
